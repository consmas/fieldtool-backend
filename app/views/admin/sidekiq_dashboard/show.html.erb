<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Sidekiq Dashboard</title>
    <style>
      body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; margin: 24px; color: #111827; background: #f9fafb; }
      h1 { margin: 0 0 16px; font-size: 24px; }
      h2 { margin: 24px 0 8px; font-size: 18px; }
      .grid { display: grid; grid-template-columns: repeat(auto-fit,minmax(180px,1fr)); gap: 10px; }
      .card { background: white; border: 1px solid #e5e7eb; border-radius: 8px; padding: 12px; }
      .label { color: #6b7280; font-size: 12px; }
      .value { font-size: 20px; font-weight: 600; margin-top: 4px; }
      table { width: 100%; border-collapse: collapse; background: white; border: 1px solid #e5e7eb; border-radius: 8px; overflow: hidden; }
      th, td { padding: 10px; border-bottom: 1px solid #f3f4f6; text-align: left; font-size: 14px; }
      th { background: #f3f4f6; }
      tr:last-child td { border-bottom: 0; }
      .muted { color: #6b7280; font-size: 12px; margin-top: 12px; }
    </style>
  </head>
  <body>
    <h1>Sidekiq Dashboard</h1>

    <div class="grid">
      <div class="card"><div class="label">Processed</div><div class="value"><%= @stats.processed %></div></div>
      <div class="card"><div class="label">Failed</div><div class="value"><%= @stats.failed %></div></div>
      <div class="card"><div class="label">Enqueued</div><div class="value"><%= @stats.enqueued %></div></div>
      <div class="card"><div class="label">Busy</div><div class="value"><%= @stats.workers_size %></div></div>
      <div class="card"><div class="label">Retries</div><div class="value"><%= @stats.retry_size %></div></div>
      <div class="card"><div class="label">Dead</div><div class="value"><%= @stats.dead_size %></div></div>
      <div class="card"><div class="label">Scheduled</div><div class="value"><%= @stats.scheduled_size %></div></div>
      <div class="card"><div class="label">Processes</div><div class="value"><%= @processes.size %></div></div>
    </div>

    <h2>Queues</h2>
    <table>
      <thead>
        <tr><th>Queue</th><th>Size</th></tr>
      </thead>
      <tbody>
        <% @queues.each do |name, size| %>
          <tr><td><%= name %></td><td><%= size %></td></tr>
        <% end %>
      </tbody>
    </table>

    <h2>Processes</h2>
    <table>
      <thead>
        <tr>
          <th>Hostname</th>
          <th>PID</th>
          <th>Busy</th>
          <th>Concurrency</th>
          <th>Queues</th>
        </tr>
      </thead>
      <tbody>
        <% @processes.each do |p| %>
          <tr>
            <td><%= p["hostname"] %></td>
            <td><%= p["pid"] %></td>
            <td><%= p["busy"] %></td>
            <td><%= p["concurrency"] %></td>
            <td><%= Array(p["queues"]).join(", ") %></td>
          </tr>
        <% end %>
      </tbody>
    </table>

    <div class="muted">Updated at <%= Time.current.utc.iso8601 %></div>
  </body>
</html>
